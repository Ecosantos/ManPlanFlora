---
title: "Supplementary material 2"
author: "Author removed for peer review"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output: 
 html_document:
  TOC: true
  toc_float: true 
  self_contained: true
---

<<<<<<< HEAD
The present document provides access to the final dataset in the manuscript *Management plans bias the number of threatened species in protected areas* in review" `r format(Sys.time(), '%Y')`. Data is automatically downloadable in the *.csv* format by pressing the "**Excel**" bottom.
=======
The present document provides access to the final dataset in the manuscript *Management plans bias the number of threatened species in protected areas* in review"
`r format(Sys.time(), '%Y')`. Data is automatically downloadable in the *.csv* format
by pressing the "**Excel**" bottom.

Column names follow Loss *et al*. *in press* and each meanings is
described below:
>>>>>>> ce1cf28d68e9e2f29148b0530155d32c6b5c7320

## Metadata

| **Column**    | **Description**                                                                             |
| :-----------: | :-----------------------------------------------------------------------------------------: |
| UC_NAME      | Protected area name                                                                         |
| ID_UC        | A unique ID number is assigned for each protected area polygon.                             |
| IUCN_CAT     | [IUCN category](https://www.iucn.org/theme/protected-areas/about/protected-area-categories) |
| ESF_ADM      | Protected area jurisdiction                                                                 |
| PLA_MAN      | Yes/No for Presence/Absence of management plans                                             |
| Richness:     | Observed richness of threatened flora specie                                                |
| Richness_pred | Best model prediction of threatened flora species                                           |
| Lat           | Protected area's centroid latitude                                                          |
| Long          | Protected area's centroid longitude                                                         |



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Cleaned dataset

```{r message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(knitr)

dir()

#FinalData<-read.csv("Supplementary material2 Data.csv",sep=";")
FinalData<-openxlsx::read.xlsx("Supplementary material2 Data.xlsx")
FinalData<-FinalData%>%mutate(across(c("HFP1993":"Lat"),as.numeric))
```

```{r echo=FALSE}
FinalData%>%
  select(-c(X1,HFP1993,UC_CODE2))%>%
  select(ID_UC2:Richness,Richness_pred,ANO2,Long,Lat)%>%
  mutate(Richness_pred=round(Richness_pred,0))%>%
  DT::datatable(editable=FALSE,extensions="Buttons",rownames = FALSE,
                options=list(
                  dom="Blfrtip",
                displayLength= 25,
                buttons=c("excel"),
                  pageLength = 5,
                  lengthMenu = c(5, 10, 20, 50),
  #               fixedColumns = TRUE,
                  autoWidth = TRUE,
                  columnDefs = list(list(className = 'dt-center', targets = c(2:8),
                                    #width = '5000px', targets = c(3:7),
                                     width= "20%", targets= 0))))%>%
    DT::formatStyle("UC_NAME2", fontSize = "50")%>%
  DT::formatRound("Long", digits=3)%>%
  DT::formatRound("Lat", digits=3)%>%
  DT::formatRound("Area", digits=3)
```

## DATA VISUALIZATION - Interactive

An interactive data visualization is provided

```{r message=FALSE, warning=FALSE, include=FALSE}
library(leaflet)
library(leaflegend)
FinalData2<-FinalData
```

```{r message=FALSE, warning=FALSE, include=FALSE}
FinalData<-FinalData2
FinalData$bins<-cut(FinalData$Richness,
breaks=c(-1,4,10,50,100,500),
labels=c("<5","5-10","10-49","50-99",">100"))

Rich_pal <- colorFactor(c("pink","blue","yellow", "orange" ,"red", "black"), domain = FinalData$bins)


FinalData<-FinalData%>%
  mutate(Richness=as.numeric(Richness))%>%
  mutate(Radius = case_when(between(Richness,0,4)  ~  log(5),
                            between(Richness,5,9)  ~  log(10),
                            between(Richness,10,50)  ~ log(50),
                            Richness  > 50  ~  log(100)))

pal_man<- colorFactor(c("tomato","royalblue2"), domain = FinalData$PLA_MAN2)
```

```{r include=FALSE}
hist(log(FinalData$Richness+1))
```

<<<<<<< HEAD
```{r message=FALSE, warning=FALSE, include=TRUE, echo=FALSE, out.width="100%", out.height="900px"}
=======
```{r message=FALSE, warning=FALSE, include=TRUE, echo=FALSE, out.width="600px", out.height="900px"}
>>>>>>> ce1cf28d68e9e2f29148b0530155d32c6b5c7320

leaflet(FinalData)%>%
 # addMiniMap()%>%  
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addSymbolsSize(
    values = ~Radius,
    shape="circle",
    opacity=.6,
    color=~pal_man(PLA_MAN2),
    fillColor = ~pal_man(PLA_MAN2),
        lng = ~Long, lat = ~Lat,
           baseSize=10,
             popup = ~paste0(UC_NAME2,
                             "<br/><strong>Jurisprudence</strong>:",ESF_ADM2,
                             "<br/><strong>Management plan.:</strong>",PLA_MAN2,
                             "<br/><strong>Threatened Species Observed:</strong>",Richness,
                             "<br/><strong>Threatened Species Predicted:</strong>",round(Richness_pred),0))%>%
  addLegendSize(
    values = ~exp(FinalData$Radius),
    color = 'black',
    title = 'Threatened species richness',
    shape = 'circle',
    orientation = 'horizontal',
    baseSize=10,
    fillOpacity = 0.3,
    breaks = 5,
    position  ='topright')%>%
  addLegend("topright", 
            pal=pal_man, values = ~PLA_MAN2,
            title = "Management plan",
            #  orientation = 'horizontal',
            labFormat = labelFormat(prefix = ""),
            opacity = 1)
  
```
