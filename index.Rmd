---
title: "Supplementary material 2"
author: "Gabriel Santos"
date: "`r format(Sys.time(), '%B %Y')`"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

The present document provides access to the final dataset in Santos et al.
`r format(Sys.time(), '%Y')`. Data is automatically downloadable in the *.csv* format
by pressing the "**Excel**" bottom.

Column names follow Loss *et al*. *in press* and each meanings is
described below:

## Metadata

+--------------+-------------------------------------------------------+
| Column       | Description                                           |
+==============+=======================================================+
| UC_NAME2     | Protected area name                                   |
+--------------+-------------------------------------------------------+
| ID_UC2       | A unique ID number is assigned for each protected     |
|              | area polygon.                                         |
+--------------+-------------------------------------------------------+
| IUCN_CAT2    |   [IUCN category](https://www.iucn.org/theme/protected-areas/about/protected-area-categories)     |
+--------------+-------------------------------------------------------+
| ESF_ADM2     | Protected area jurisdiction                           |
+--------------+-------------------------------------------------------+
| PLA_MAN2     | Yes/No for Presence/Absence of management plans       |
+--------------+-------------------------------------------------------+
| Richness:    | Observed richness of endangered flora specie          |
+--------------+-------------------------------------------------------+
| Richness_pred  | Best model prediction of endangered flora species   |
+--------------+-------------------------------------------------------+
| Lat          | Protected area's centroid latitude                    |
+--------------+-------------------------------------------------------+
| Long         | Protected area's centroid longitude                   |
+--------------+-------------------------------------------------------+

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Cleaned dataset

```{r message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(knitr)
setwd("C:/Artigos e resumos publicados submetidos ideias/Em desenvolvimento/INMA/Paper 1 - Endangered flora and Management plans")

dir()
FinalData<-read.csv("./Script and Data/Supplementary material2.csv")
```

```{r echo=FALSE}
FinalData%>%
  select(-X)%>%
  mutate(Richness_pred=round(Richness_pred,0))%>%
  DT::datatable(editable=FALSE,extensions="Buttons",rownames = FALSE,
                options=list(
                  dom="Blfrtip",
                displayLength= 25,
                buttons=c("excel"),
                  pageLength = 5,
                  lengthMenu = c(5, 10, 20, 50),
                 fixedColumns = TRUE,
                  autoWidth = TRUE,
                  columnDefs = list(list(className = 'dt-center', targets = c(2:8),
                                    #width = '5000px', targets = c(3:7),
                                     width= "20%", targets= 0))))%>%
    DT::formatStyle("UC_NAME2", fontSize = "50")%>%
  DT::formatRound("Long", digits=3)%>%
  DT::formatRound("Lat", digits=3)
```

## DATA VISUALIZATION - Interactive
An interactive data visualization is provided


```{r message=FALSE, warning=FALSE, include=FALSE}
library(leaflet)
library(leaflegend)
FinalData2<-FinalData
```



```{r message=FALSE, warning=FALSE, include=FALSE}
FinalData<-FinalData2
FinalData$bins<-cut(FinalData$Richness,
breaks=c(-1,4,10,50,100,500),
labels=c("<5","5-10","10-49","50-99",">100"))

Rich_pal <- colorFactor(c("pink","blue","yellow", "orange" ,"red", "black"), domain = FinalData$bins)


FinalData<-FinalData%>%
mutate(Richness=as.numeric(Richness))%>%
    mutate(Radius = case_when(between(Richness,0,4)  ~  1,
                            between(Richness,5,9)  ~  3,
                            between(Richness,10,50)  ~ 5,
                            Richness  > 50  ~  10))


pal_man<- colorFactor(c("tomato","royalblue2"), domain = FinalData$PLA_MAN2)
```



```{r include=FALSE}
hist(log(FinalData$Richness+1))
```
```{r message=FALSE, warning=FALSE, include=TRUE, echo=FALSE, out.width="600px", out.height="900px"}
leaflet(FinalData, height=600, width=1000)%>%
   addMiniMap()%>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
addCircleMarkers(lng = ~Long, lat = ~Lat,
#                 clusterOptions = markerClusterOptions(),
#                  color = ~ifelse(PLA_MAN2=="Sim","Blue","Red"),
                  radius = ~Radius*2,
                       color = ~pal_man(PLA_MAN2),
#                       color = ~Rich_pal(bins),
#                       color = ~pal(na.omit(Richness+1)),
             popup = ~paste0(UC_NAME2,
	"<br/><strong>Jurisdiction</strong>:",ESF_ADM2,
	"<br/><strong>Management plan:</strong>",PLA_MAN2,
	"<br/><strong>Endangered Species Observed:</strong>",Richness,
	"<br/><strong>Endangered Species Predicted:</strong>",round(Richness_pred),0))%>%
addLegendSize(
    values = FinalData$Radius*5,
 #   labels = FinalData$bins,
    color = 'black',
    strokeWidth = 2,
    title = 'Endangered species richness',
    shape = 'circle',
    orientation = 'horizontal',
    opacity = .5,
    fillOpacity = .3,
    breaks = 4,
    position = 'topright') %>%
  addLegend("topright", pal=pal_man, values = ~PLA_MAN2,
    title = "Management plan",
#  orientation = 'horizontal',
    labFormat = labelFormat(prefix = ""),
    opacity = 1)
```

